<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>Outspoke - Cycling Information Map </title>
</head>
<body>

  <div id="cm-example" style="width: 500px; height: 500px"></div>

  <script type="text/javascript" src="http://tile.cloudmade.com/wml/latest/web-maps-lite.js"></script>
  <script type="text/javascript">

    <!--set up map -->
    var cloudmade = new CM.Tiles.CloudMade.Web({key: '4a7ecbf54cd74519a944efa10e330c2e'});
    var map = new CM.Map('cm-example', cloudmade);
    map.setCenter(new CM.LatLng(53.3649, -6.218), 12);

    <!-- map controls -->
    var topRight = new CM.ControlPosition(CM.TOP_RIGHT, new CM.Size(50, 20));
    map.addControl(new CM.SmallMapControl(), topRight);
    map.addControl(new CM.LargeMapControl());
    map.addControl(new CM.ScaleControl());
    map.addControl(new CM.OverviewMapControl());
    
     <!-- set the centre point of the map -->
    var dublinLocation = new CM.LatLng(53.345171, -6.275854);
    map.setCenter(dublinLocation, 12);
    


     downloadUrl("display2.php", function(data)
         {
            var xml = data.responseXML;
            var accidents = xml.documentElement.getElementsByTagName("accident");
            for (var i = 0; i < accidents.length; i++)
            {
                var severity = accidents[i].getAttribute("severity");
                var vehicle = accidents[i].getAttribute("vehicle");
                var time = accidents[i].getAttribute("time");
                var date = accidents[i].getAttribute("date");
                var comment = accidents[i].getAttribute("comment");
                var cause = accidents[i].getAttribute("acc_cause");
                var point = new CM.LatLng(
                    parseFloat(accidents[i].getAttribute("lat")),
                    parseFloat(accidents[i].getAttribute("lng")));
                var html = "<b>Severity: " +severity+ "</b> <br>Vehicle: " + vehicle + "<br>Date: " + date+ "<br>Time: " +time +"<br>Cause: "+cause+ "<br>Comment: " +comment;                 
                var marker = new CM.Marker(point, { title: severity });
                map.addOverlay(marker);
                marker.openInfoWindow(html);                                     
               }
            });
            
         downloadUrl("display_theft.php", function(data)
         {
            var xml = data.responseXML;
            var thefts = xml.documentElement.getElementsByTagName("theft");
            for (var i = 0; i < thefts.length; i++)
            {
                var date_left = thefts[i].getAttribute("date_left");
                var time_left = thefts[i].getAttribute("time_left");
                var found_date = thefts[i].getAttribute("found_date");                
                var point = new CM.LatLng(
                    parseFloat(thefts[i].getAttribute("lat")),
                    parseFloat(thefts[i].getAttribute("lng")));
                var html = date_left+ " " +found_date;                 
                var marker = new CM.Marker(point, { title: 'theft' });
                map.addOverlay(marker);
                marker.openInfoWindow(html);                                     
               }
            });
         downloadUrl("display_hazards.php", function(data)
         {
            var xml = data.responseXML;
            var hazards = xml.documentElement.getElementsByTagName("hazard");
            for (var i = 0; i < hazards.length; i++)
            {
                var date = hazards[i].getAttribute("date");
                var time = hazards[i].getAttribute("time");
                var explanation = hazards[i].getAttribute("explanation");                
                var point = new CM.LatLng(
                    parseFloat(hazards[i].getAttribute("lat")),
                    parseFloat(hazards[i].getAttribute("lng")));                     
                var marker = new CM.Marker(point, { title: 'hazard' });
                map.addOverlay(marker);
                marker.openInfoWindow(explanation);                                     
               }
            });        
            
      function downloadUrl(url,callback)
      {
        var request = window.ActiveXObject ?
          new ActiveXObject('Microsoft.XMLHTTP') :
          new XMLHttpRequest;
          
          request.onreadystatechange = function()
          {
            if (request.readyState == 4)
            {
                request.onreadystatechange = doNothing;
                callback(request, request.status);
            }
           };
           
           request.open('GET', url, true);
           request.send(null);
         }  
          function doNothing(){}
   
  </script>

  <div id="message">Drag or click the map.</div>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="c/s.css" type="text/css">
<title>outspoken</title>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.css" />
</head>
<body>
<script src="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.js"></script>
<div id="outside-border">
<div id="header"><a href="index.html"><img src="i/logo.png" /></a>
<div id="topnav">
<ul>
<a href="report.html"><li>Make a Report</li></a>
<li>Map</li>
<a href="http://bicycle-sadness.tumblr.com/" target="_blank"><li>Blog</li></a>
<li>About Us</li>
</ul>	
</div><!-- /topnav -->
</div>
<div id="container">
	<div id="left">
		<div id="mapoverlay">
			<p class="home">OutSpoken is crowd-sourced cycling information for the masses. Cyclists contribute, cyclists benefit. When you spot a problem or experience an accident or near miss, report it so that we can build up more information for cyclists. Before you set out on a new route, check the route you plan to take.</p>
		</div><!-- map overlay -->
			<div id="actionbuttons">
				<ul id="homemenu">
				<li><a href="report.html"><img src="i/report_btn.png" />Make a Report</a></li>
				<li><img src="i/map_btn.png" />Map</li>
				<li><a href="http://bicycle-sadness.tumblr.com/" target="_blank"><img src="i/blog_btn.png" />Blog</a></li>
				<li><img src="i/about_btn.png" />About</li>
			</ul>
			</div><!-- /actionbuttons --> 
		<div id="map"></div>
	</div><!-- /left --> 
	
	<div id="right">
		<div id="stream">
		<img src="i/t.png" />	
		</div><!- /stream -->
		
		<div id="appwidgets">
		<img src="i/apple.png" />
		<img src="i/android.png" />
		</div><!-- /appwidgets -->
	</div><!-- /right -->
</div><!-- container -->
<div id="footer"></div>
</div><!-- /outside-border -->
<script type="text/javascript" src="http://tile.cloudmade.com/wml/latest/web-maps-lite.js"></script>
  <script id="map_functions" type="text/javascript">
<!-- simple1: http://leaflet.cloudmade.com/examples/quick-start.html-->
<!-- tutorial commands to create "disp" folder, will push it too-->

	
	
	var cloudmade = new L.TileLayer('http://{s}.tile.cloudmade.com/4a7ecbf54cd74519a944efa10e330c2e/997/256/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
    maxZoom: 18
});

<!-- advanced stuff for the layers, funky-->
var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/4a7ecbf54cd74519a944efa10e330c2e/{styleId}/256/{z}/{x}/{y}.png',
    cloudmadeAttribution = 'OutSpoken, Dublin, 2012',
    cloudmadeOptions = {maxZoom: 18, attribution: cloudmadeAttribution};

var minimal = new L.TileLayer(cloudmadeUrl, cloudmadeOptions, {styleId: 22677}),
    midnightCommander = new L.TileLayer(cloudmadeUrl, cloudmadeOptions, {styleId: 999});

<!-- the fun begins, we create a new Layer for each cate., need to create this before we actually parse the markers-->
	var accidentsLayer = new L.LayerGroup();
	var theftLayer = new L.LayerGroup();
	var hazardLayer = new L.LayerGroup();
	
// Define the icons to be applied to the markers
var AccIcon = L.Icon.extend({
    iconUrl: 'dist/images/accident.png',
    shadowUrl: '../dist/images/marker-shadow.png',
    iconSize: new L.Point(38, 95),
    shadowSize: new L.Point(68, 95),
    iconAnchor: new L.Point(22, 94),
    popupAnchor: new L.Point(-3, -76)
});

var HazIcon = L.Icon.extend({
    iconUrl: 'dist/images/generalhazard.png',
    shadowUrl: 'dist/images/marker-shadow.png',
    iconSize: new L.Point(38, 95),
    shadowSize: new L.Point(68, 95),
    iconAnchor: new L.Point(22, 94),
    popupAnchor: new L.Point(-3, -76)
});

var TheftIcon = L.Icon.extend({
    iconUrl: 'dist/images/clippers.png',
    shadowUrl: 'dist/images/marker-shadow.png',
    iconSize: new L.Point(38, 95),
    shadowSize: new L.Point(68, 95),
    iconAnchor: new L.Point(22, 94),
    popupAnchor: new L.Point(-3, -76)
});	
var map = new L.Map('map', {
    center: new L.LatLng(53.3649, -6.218),
    zoom: 12,
    layers: [minimal, accidentsLayer,theftLayer,hazardLayer]
});

<!-- Adding the controls -->
var baseMaps = {
    "Minimal": minimal,
    "Night View": midnightCommander
};

var overlayMaps = {
    "Accidents": accidentsLayer,
    "Thefts": theftLayer,
    "Hazards": hazardLayer
};

var layersControl = new L.Control.Layers(baseMaps, overlayMaps);
//map.addControl(layersControl);

var accidentsLayer = new L.LayerGroup();
<!-- modified the marker bit, swapped for L instead of CM.-->
     downloadUrl("display2.php", function(data)
         {
            var xml = data.responseXML;
            var accidents = xml.documentElement.getElementsByTagName("accident");
            for (var i = 0; i < accidents.length; i++)
            {
                var severity = accidents[i].getAttribute("severity");
                var vehicle = accidents[i].getAttribute("vehicle");
                var time = accidents[i].getAttribute("time");
                var date = accidents[i].getAttribute("date");
                var comment = accidents[i].getAttribute("comment");
                var cause = accidents[i].getAttribute("acc_cause");
                var point = new L.LatLng(
                    parseFloat(accidents[i].getAttribute("lat")),
                    parseFloat(accidents[i].getAttribute("lng")));
                var html = "<b>Severity: " +severity+ "</b> <br>Vehicle: " + vehicle + "<br>Date: " + date+ "<br>Time: " +time +"<br>Cause: "+cause+ "<br>Comment: " +comment;                 
                var marker = new L.Marker(point, { title: 'theft' });
                marker.bindPopup(html); //adding information
                accidentsLayer.addLayer(marker);  //we add the marker to the layer, simple2                                 
               }
            });

	map.addLayer(accidentsLayer); //insert the Layer Accidents into map.            
           
            
         downloadUrl("display_theft.php", function(data)
         {
            var xml = data.responseXML;
            var thefts = xml.documentElement.getElementsByTagName("theft");
            for (var i = 0; i < thefts.length; i++)
            {
                var date_left = thefts[i].getAttribute("date_left");
                var time_left = thefts[i].getAttribute("time_left");
                var found_date = thefts[i].getAttribute("found_date");                
                var point = new L.LatLng(
                    parseFloat(thefts[i].getAttribute("lat")),
                    parseFloat(thefts[i].getAttribute("lng")));
                var html = date_left+ " " +found_date;                 
                var marker = new L.Marker(point, { title: 'theft' });
                marker.bindPopup(html) //adding html information
                theftLayer.addLayer(marker);                                      
               }
            });

  map.addLayer(accidentsLayer); //insert the Layer Accidents into map.
  
       function downloadUrl(url,callback)
      {
        var request = window.ActiveXObject ?
          new ActiveXObject('Microsoft.XMLHTTP') :
          new XMLHttpRequest;
          
          request.onreadystatechange = function()
          {
            if (request.readyState == 4)
            {
                request.onreadystatechange = doNothing;
                callback(request, request.status);
            }
           };
           
           request.open('GET', url, true);
           request.send(null);
         }  
          function doNothing(){}
  </script>
   <!-- Validation Functions   -->
  <script src="js/validation_functions.js"></script>

</body>
</html>
